$(function(){AbViewController.initialize().then(function(){}).catch(function(e){console.log("[이미지 뷰어 초기화 오류]"),console.log(e),AbMsgBox.errorHtml("엔진 준비 중 오류가 발생했습니다<br/>페이지를 다시 로드해주세요")})});var AbViewController={imageViewer:null,onPreInitailize:null,onInitailize:null,initialize:function(){return this.initServerUrls(),this.initEnvironment(),AbCommon.isFunction(this.onPreInitailize)&&this.onPreInitailize(),this.loadConfig().then(function(e){return this.prepare(e)}.bind(this)).then(function(e){return this.initImageViewer(e).then(function(){AbCommon.isFunction(this.onInitailize)&&this.onInitailize(this.imageViewer)}.bind(this))}.bind(this))},initServerUrls:function(){AbVendor.executePath="resources/"+AbVendor.executePath,AbImageLoader.executePath="resources/"+AbImageLoader.executePath,AbImageLoader.URLS.CONVERTER="api/doc",AbImageViewer.prototype.URLS.CONFIG="api/config",AbImageViewer.prototype.URLS.PERMISSION="api/permission",AbImageViewer.prototype.URLS.OPEN="api/images",AbImageViewer.prototype.URLS.SAVE.ALLOC="api/alloc",AbImageViewer.prototype.URLS.SAVE.MODIFY="api/modify-prepare",AbImageViewer.prototype.URLS.SAVE.IMAGE="api/save-image",AbImageViewer.prototype.URLS.SAVE.REMOVE="api/remove",AbImageViewer.prototype.URLS.SAVE.COMPLETED="api/save-completed",AbImageViewer.prototype.URLS.PRINT.ALLOC="api/print-support/alloc",AbImageViewer.prototype.URLS.PRINT.IMAGE="api/print-support/save",AbImageViewer.prototype.URLS.PRINT.REMOVE="api/print-support/remove",AbImageViewer.prototype.URLS.PRINT.DOWNLOAD="print-support/img"},initEnvironment:function(){AbCommon.ieVersion()!=-1&&(AbCommon.ENABLE_WEB_WORKER=!1),AbImageViewer.prototype.PARALLELS=3,AbImageViewer.prototype.SPLIT_DATA_SIZE=307200},loadConfig:function(){var e=AbLoading.get({text:"환경설정을 불러오는 중입니다..."});e.show();var i=$("#param-a").val(),t=this;return new Promise(function(r,n){AbCommon.ajax({caller:t,title:"서버 옵션 로드",url:AbImageViewer.prototype.URLS.CONFIG,data:{a:i},success:function(i){e.hide(),r(i)},error:function(i){e.hide(),n(i)}})})},prepare:function(e){var i=null;if(e&&e.auth&&e.auth.config.enabled===!0){var t="local-storage"===e.auth.config.account.source,r="session-storage"===e.auth.config.account.source;if(t||r){var n=null;r?n=sessionStorage.getItem(e.auth.config.account.field):t&&(n=localStorage.getItem(e.auth.config.account.field)),i=this.loadPermissions(n).then(function(i){return e.auth.permission=i,e.auth.permission.map=this.permissionMap(e.auth.permission),this.setLayout(e.auth.permission),e}.bind(this))}else e.auth.permission.map=this.permissionMap(e.auth.permission)}return i||(i=Promise.resolve(e)),i},permissionMap:function(e){var i=e&&e.permissions?e.permissions.length:0;if(!i)return null;for(var t={},r=0;r<i;r++){var n=e.permissions[r];t[n.itm]="Y"===n.useYn}return t},setLayout:function(e){var i=e?e.level:-1,t=e&&e.map?e.map:{};if(0!=i)for(var r=$("[ab-perm],[tb-topic]"),n=r.length,o=0;o<n;o++){var a=r.get(o),s=$(a),p=s.attr("tb-topic"),u=s.attr("ab-perm"),m=!1;if(p)m=t[p]===!0;else if(u)for(var l=u.trim().split(/\s*,\s*/g),c=l.length,h=0;h<c;h++){var p=l[h];if(t[p]===!0){m=!0;break}}m||s.detach()}},loadPermissions:function(e){if(!e)return Promise.resolve();var i=AbLoading.get({text:"권한 정보를 불러오는 중입니다..."});i.show();var t=this;return new Promise(function(r,n){AbCommon.ajax({caller:t,title:"권한 정보 로드",url:AbImageViewer.prototype.URLS.PERMISSION,data:{value:e},success:function(e){i.hide(),r(e)},error:function(e){i.hide(),n(e)}})})},initImageViewer:function(e){var i=2,t=new AbImageViewer({margin:{left:i,top:i,right:i,bottom:i},config:e?e.viewer:null,permission:{auth:e?e.auth:null,check:function(e){var i=this.auth?this.auth.config:null;if(i.enabled!==!0)return!0;var t=this.auth?this.auth.permission:null,r=t?t.level:-1,n=t&&t.map?t.map:{};return 0===r||n.hasOwnProperty(e)&&n[e]===!0}}});"undefined"!=typeof iAbViewer&&iAbViewer.regist(t),this.imageViewer=t;var r=e&&e.viewer&&e.viewer.waterMark&&e.viewer.waterMark.image?$.trim(e.viewer.waterMark.image):null,n=null;return n=r?t.waterMark.image(r):Promise.resolve(),n.then(function(){return t.install().then(function(){return this.loadedImageViewer()}.bind(this))}.bind(this))},loadedImageViewer:function(){AbNoop.exec();var e=$("#param-id").val();return e?this.imageViewer.openImages(e):Promise.resolve()}};